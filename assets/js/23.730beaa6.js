(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{552:function(s,a,e){s.exports=e.p+"assets/img/image-20200404094800622.cebaa87a.png"},553:function(s,a,e){s.exports=e.p+"assets/img/image-20210609000002940.7f42ba91.png"},674:function(s,a,e){"use strict";e.r(a);var t=e(10),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[t("a",{attrs:{href:"https://gitee.com/yooome/golang/blob/main/k8s%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/Kubernetes%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B.md#2-kubernetes%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://www.bilibili.com/video/BV1Qv41167ck?p=5",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频教程"),t("OutboundLink")],1)]),s._v(" "),t("h1",{attrs:{id:"_2-kubernetes集群环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-kubernetes集群环境搭建"}},[s._v("#")]),s._v(" 2. kubernetes集群环境搭建")]),s._v(" "),t("h2",{attrs:{id:"_2-1-前置知识点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-前置知识点"}},[s._v("#")]),s._v(" 2.1 前置知识点")]),s._v(" "),t("p",[s._v("目前生产部署Kubernetes 集群主要有两种方式：")]),s._v(" "),t("p",[t("strong",[s._v("kubeadm")])]),s._v(" "),t("p",[s._v("Kubeadm 是一个K8s 部署工具，提供"),t("code",[s._v("kubeadm init")]),s._v(" 和"),t("code",[s._v("kubeadm join")]),s._v("，用于快速部署Kubernetes 集群。")]),s._v(" "),t("p",[s._v("官方地址："),t("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("二进制包")])]),s._v(" "),t("p",[s._v("从github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes 集群。")]),s._v(" "),t("p",[s._v("Kubeadm 降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，推荐使用二进制包部署Kubernetes 集群，虽然手动部署麻烦点，期间可以学习很多工作原理，也利于后期维护。")]),s._v(" "),t("p",[t("img",{attrs:{src:e(552),alt:"image-20200404094800622"}})]),s._v(" "),t("h2",{attrs:{id:"_2-2-kubeadm-部署方式介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-kubeadm-部署方式介绍"}},[s._v("#")]),s._v(" 2.2 kubeadm 部署方式介绍")]),s._v(" "),t("p",[s._v("kubeadm 是官方社区推出的一个用于快速部署kubernetes 集群的工具，这个工具能通过两条指令完成一个kubernetes 集群的部署：")]),s._v(" "),t("ul",[t("li",[s._v("创建一个Master 节点"),t("code",[s._v("kubeadm init")])]),s._v(" "),t("li",[s._v("将Node 节点加入到当前集群中"),t("code",[s._v("kubeadm join <Master 节点的IP 和端口>")])])]),s._v(" "),t("h2",{attrs:{id:"_2-3-安装要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装要求"}},[s._v("#")]),s._v(" 2.3 安装要求")]),s._v(" "),t("p",[s._v("在开始之前，部署Kubernetes 集群机器需要满足以下几个条件：")]),s._v(" "),t("ul",[t("li",[s._v("一台或多台机器，操作系统CentOS7.x-86_x64")]),s._v(" "),t("li",[s._v("硬件配置：2GB 或更多RAM，2 个CPU 或更多CPU，硬盘30GB 或更多")]),s._v(" "),t("li",[s._v("集群中所有机器之间网络互通")]),s._v(" "),t("li",[s._v("可以访问外网，需要拉取镜像")]),s._v(" "),t("li",[s._v("禁止swap 分区")])]),s._v(" "),t("h2",{attrs:{id:"_2-4-最终目标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-最终目标"}},[s._v("#")]),s._v(" 2.4 最终目标")]),s._v(" "),t("ul",[t("li",[s._v("在所有节点上安装 Docker 和 kubeadm")]),s._v(" "),t("li",[s._v("部署 Kubernetes Master")]),s._v(" "),t("li",[s._v("部署容器网络插件")]),s._v(" "),t("li",[s._v("部署 Kubernetes Node，将节点加入Kubernetes 集群中")]),s._v(" "),t("li",[s._v("部署 Dashboard Web 页面，可视化查看Kubernetes 资源")])]),s._v(" "),t("h2",{attrs:{id:"_2-5-准备环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-准备环境"}},[s._v("#")]),s._v(" 2.5 准备环境")]),s._v(" "),t("p",[t("img",{attrs:{src:e(553),alt:"image-20210609000002940"}})]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("角色")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("IP地址")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("组件")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CentOS7-Node1")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.85.131")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CentOS7-Node2")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.85.132")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CentOS7-Node3")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.85.133")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CentOS7-Node4")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.85.134")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CentOS7-Node5")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.85.135")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-6-环境初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-环境初始化"}},[s._v("#")]),s._v(" 2.6 环境初始化")]),s._v(" "),t("h3",{attrs:{id:"_2-6-1-检查操作系统的版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-1-检查操作系统的版本"}},[s._v("#")]),s._v(" 2.6.1 检查操作系统的版本")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此方式下安装kubernetes集群要求Centos版本要在7.5或之上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/redhat-release\nCentOS Linux release "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.9")]),s._v(".2009 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-6-2-主机名解析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-2-主机名解析"}},[s._v("#")]),s._v(" 2.6.2 主机名解析")]),s._v(" "),t("p",[s._v("为了方便集群节点间的直接调用，在这个配置一下主机名解析，企业中推荐使用内部DNS服务器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机名成解析 编所使用台服务器的/etc/hosts文件，添加下面内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.130 CentOS7-Node0\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.131 CentOS7-Node1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.132 CentOS7-Node2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.133 CentOS7-Node3\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.134 CentOS7-Node4\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.135 CentOS7-Node5\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.136 CentOS7-Node6\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.137 CentOS7-Node7\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.138 CentOS7-Node8\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.139 CentOS7-Node9\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_2-6-3-时间同步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-3-时间同步"}},[s._v("#")]),s._v(" 2.6.3 时间同步")]),s._v(" "),t("p",[s._v("kubernetes要求集群中的节点时间必须精确一直，这里使用chronyd服务从网络同步时间")]),s._v(" "),t("p",[s._v("企业中建议配置内部的时间同步服务器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动chronyd服务")]),s._v("\nsystemctl start chronyd\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" chronyd\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_2-6-4-禁用-iptable-和-firewalld-服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-4-禁用-iptable-和-firewalld-服务"}},[s._v("#")]),s._v(" 2.6.4 禁用 iptable 和 firewalld 服务")]),s._v(" "),t("p",[s._v("kubernetes和docker 在运行的中会产生大量的iptables规则，为了不让系统规则跟它们混淆，直接关闭系统的规则")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 关闭firewalld服务")]),s._v("\nsystemctl stop firewalld\nsystemctl disable firewalld\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 关闭iptables服务")]),s._v("\nsystemctl stop iptables\nsystemctl disable iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_2-6-5-禁用-selinux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-5-禁用-selinux"}},[s._v("#")]),s._v(" 2.6.5 禁用 selinux")]),s._v(" "),t("p",[s._v("selinux是linux系统一下的一个安全服务，如果不关闭它，在安装集群中会产生各种各样的奇葩问题")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 SELinux 设置为 permissive 模式（相当于将其禁用）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" setenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久设置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 编辑 /etc/selinux/config 文件，修改SELINUX的值为permissive")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("permissive\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 使用 sed 命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^SELINUX=enforcing$/SELINUX=permissive/'")]),s._v(" /etc/selinux/config\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改完毕之后需要重启linux服务")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_2-6-6-禁用swap分区"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-6-禁用swap分区"}},[s._v("#")]),s._v(" 2.6.6 禁用swap分区")]),s._v(" "),t("p",[s._v("swap分区值的是虚拟内存分区，它的作用是物理内存使用完，之后将磁盘空间虚拟成内存来使用，启用swap设备会对系统的性能产生非常负面的影响，因此kubernetes要求每个节点都要禁用swap设备，但是如果因为某些原因确实不能关闭swap分区，就需要在集群安装过程中通过明确的参数进行配置说明")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑分区配置文件/etc/fstab，注释掉swap分区一行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改完毕之后需要重启linux服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/fstab\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注释掉 /dev/mapper/centos-swap swap")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /dev/mapper/centos-swap swap")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-6-7-修改linux的内核参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-7-修改linux的内核参数"}},[s._v("#")]),s._v(" 2.6.7 修改linux的内核参数")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/modules-load.d/k8s.conf")]),s._v("\nbr_netfilter\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/sysctl.d/k8s.conf")]),s._v("\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" sysctl --system\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载网桥过滤模块")]),s._v("\nmodprobe br_netfilter\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看网桥过滤模块是否加载成功")]),s._v("\nlsmod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" br_netfilter\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"_2-6-8-配置ipvs功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-8-配置ipvs功能"}},[s._v("#")]),s._v(" 2.6.8 配置ipvs功能")]),s._v(" "),t("p",[s._v("在Kubernetes中Service有两种带来模型，一种是基于iptables的，一种是基于ipvs的两者比较的话，ipvs的性能明显要高一些，但是如果要使用它，需要手动载入ipvs模块")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.安装ipset和ipvsadm")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ipset ipvsadm -y\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.添加需要加载的模块写入脚本文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" /etc/sysconfig/modules/ipvs.modules")]),s._v("\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.为脚本添加执行权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/sysconfig/modules/ipvs.modules\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.执行脚本文件")]),s._v("\n/bin/bash /etc/sysconfig/modeules/ipvs.modules\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5.查看对应的模块是否加载成功")]),s._v("\nlsmod "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -e -ip_vs -e nf_conntrack_ipv4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("此时开始重启服务器")]),s._v(" "),t("h3",{attrs:{id:"_2-6-9-安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-9-安装docker"}},[s._v("#")]),s._v(" 2.6.9 安装docker")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、切换镜像源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d.docker-ce.repo\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、查看当前镜像源中支持的docker版本")]),s._v("\nyum list docker-ce --showduplicates\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、安装特定版本的docker-ce")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须制定--setopt=obsoletes=0，否则yum会自动安装更高版本")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --setopt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("obsoletes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" docker-ce-18.06.3.ce-3.e17 -y\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、添加一个配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Docker 在默认情况下使用Vgroup Driver为cgroupfs，而Kubernetes推荐使用systemd来替代cgroupfs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/docker\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat <<EOF> /etc/docker/daemon.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data-root"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/data/docker"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://hub-mirror.c.163.com"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.mirrors.ustc.edu.cn"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://reg-mirror.qiniu.com"')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://dockerhub.azk8s.cn"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、启动dokcer")]),s._v("\nsystemctl restart docker\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h3",{attrs:{id:"_2-6-10-安装kubernetes组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-10-安装kubernetes组件"}},[s._v("#")]),s._v(" 2.6.10 安装Kubernetes组件")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://developer.aliyun.com/mirror/kubernetes",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、由于kubernetes的镜像在国外，速度比较慢，这里切换成国内的镜像源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、编辑/etc/yum.repos.d/kubernetes.repo,添加下面的配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       \n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("repo_gpgcheck")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgkey")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("exclude")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubelet kubeadm kubectl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、安装kubeadm、kubelet和kubectl")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --setopt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("obsoletes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、配置kubelet的cgroup")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑/etc/sysconfig/kubelet, 添加下面的配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_CGROUP_ARGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cgroup-driver=systemd"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_PROXY_MODE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ipvs"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、设置kubelet开机自启")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h3",{attrs:{id:"_2-6-11-准备集群镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-11-准备集群镜像"}},[s._v("#")]),s._v(" 2.6.11 准备集群镜像")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在安装kubernetes集群之前，必须要提前准备好集群需要的镜像，所需镜像可以通过下面命令查看")]),s._v("\nkubeadm config images list\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取镜像")]),s._v("\nkubeadm config images pull --image-repository"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.aliyuncs.com/google_containers\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存镜像")]),s._v("\ndocker save -o k8s-base-images.tar "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker images "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" google_containers "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'BEGIN{OFS=":";ORS=" "}{print $1,$2}\'')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_2-6-11-集群初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-11-集群初始化"}},[s._v("#")]),s._v(" 2.6.11 集群初始化")]),s._v(" "),t("blockquote",[t("p",[s._v("下面的操作只需要在master节点上执行即可")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建集群")]),s._v("\nkubeadm init --apiserver-advertise-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.131 --image-repository registry.aliyuncs.com/google_containers --service-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12 --pod-network-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建必要文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("blockquote",[t("p",[s._v("下面的操作只需要在node节点上执行即可")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".85.131:6443 --token awk15p.t6bamck54w69u4s8 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:a94fa09562466d32d29523ab6cff122186f1127599fa4dcd5fa0152694f17117 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("在master上查看节点信息")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get nodes\nNAME            STATUS     ROLES                  AGE   VERSION\ncentos7-node1   NotReady   control-plane,master   9h    v1.22.3\ncentos7-node3   NotReady   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                 9h    v1.22.3\ncentos7-node4   NotReady   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                 9h    v1.22.3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-6-13-安装网络插件-只在master节点操作即可"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-13-安装网络插件-只在master节点操作即可"}},[s._v("#")]),s._v(" 2.6.13 安装网络插件，只在master节点操作即可")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("由于外网不好访问，如果出现无法访问的情况，可以直接用下面的 记得文件名是kube-flannel.yml，位置：/root/kube-flannel.yml内容：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("https://github.com/flannel-io/flannel/tree/master/Documentation/kube-flannel.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("s",[s._v("下载完成"),t("code",[s._v("kube-flannel.yml")]),s._v("后,将文件中的"),t("code",[s._v("quay.io")]),s._v("替换为"),t("code",[s._v("quay-mirror.qiniu.com")])]),s._v("\n下载完成"),t("code",[s._v("kube-flannel.yml")]),s._v("后,将文件中的"),t("code",[s._v("quay.io")]),s._v("替换为"),t("code",[s._v("quay.mirrors.ustc.edu.cn")])]),s._v(" "),t("p",[s._v("准备镜像")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取镜像")]),s._v("\ndocker pull rancher/mirrored-flannelcni-flannel-cni-plugin:v1.2\ndocker pull quay.mirrors.ustc.edu.cn/coreos/flannel:v0.15.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存镜像")]),s._v("\ndocker save -o k8s-network-flannel-images.tar "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker images "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" flannel "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'BEGIN{OFS=":";ORS=" "}{print $1,$2}\'')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-6-14-重启kubelet和docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-14-重启kubelet和docker"}},[s._v("#")]),s._v(" 2.6.14 重启kubelet和docker")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启kubelet")]),s._v("\nsystemctl restart kubelet\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("使用配置文件启动fannel")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl apply -f kube-flannel.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("等待它安装完毕 发现已经是 集群的状态已经是Ready")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("NAME            STATUS     ROLES                  AGE     VERSION\ncentos7-node1   Ready      control-plane,master   10m     v1.22.3\ncentos7-node2   Ready      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                 73s     v1.22.3\ncentos7-node3   Ready      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                 84s     v1.22.3\ncentos7-node4   Ready      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                 2m22s   v1.22.3\ncentos7-node5   Ready      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("                 2m23s   v1.22.3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("若没有变成Ready,可以检查 kube-system 的 pod 是否正常")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get pods -n kube-system\n\nNAME                                    READY   STATUS                  RESTARTS      AGE\ncoredns-7f6cbbb7b8-6lbzt                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Pending                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             9h\ncoredns-7f6cbbb7b8-flwg8                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Pending                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             9h\netcd-centos7-node1                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    9h\nkube-apiserver-centos7-node1            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    9h\nkube-controller-manager-centos7-node1   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    9h\nkube-flannel-ds-5nk4h                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Init:0/2                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m39s\nkube-flannel-ds-5rf6h                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Init:0/2                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m39s\nkube-flannel-ds-t6dv7                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Init:ImagePullBackOff   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3m39s\nkube-proxy-pwprt                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    9h\nkube-proxy-v68fz                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("31m ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   9h\nkube-proxy-vbwb8                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    9h\nkube-scheduler-centos7-node1            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    9h\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现有镜像是 Init:ImagePullBackOff")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后重新拉取镜像解决")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"_2-6-16-kubeadm中的命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-16-kubeadm中的命令"}},[s._v("#")]),s._v(" 2.6.16 kubeadm中的命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成 新的token")]),s._v("\nkubeadm token create --print-join-command\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_2-7-集群测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-集群测试"}},[s._v("#")]),s._v(" 2.7 集群测试")]),s._v(" "),t("h3",{attrs:{id:"_2-7-1-创建一个nginx服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-1-创建一个nginx服务"}},[s._v("#")]),s._v(" 2.7.1 创建一个nginx服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl create deployment nginx --image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-7-2-暴露端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-2-暴露端口"}},[s._v("#")]),s._v(" 2.7.2 暴露端口")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl expose deploy nginx --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --target-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-7-3-查看服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-3-查看服务"}},[s._v("#")]),s._v(" 2.7.3 查看服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get pod,svc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("NAME                         READY   STATUS    RESTARTS   AGE\npod/nginx-6799fc88d8-qd2nm   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m4s\n\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nservice/kubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        20m\nservice/nginx        NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),s._v(".20.8   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32200/TCP   113s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("浏览器可以打开 http://192.168.85.131:32200 访问 nginx 服务")])])}),[],!1,null,null,null);a.default=n.exports}}]);