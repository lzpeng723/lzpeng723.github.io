(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{700:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"ansible-常用模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-常用模块"}},[s._v("#")]),s._v(" ansible 常用模块")]),s._v(" "),a("h3",{attrs:{id:"_1-主机连通性测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主机连通性测试"}},[s._v("#")]),s._v(" 1）主机连通性测试")]),s._v(" "),a("p",[s._v("我们使用"),a("code",[s._v("ansible test -m ping")]),s._v("命令来进行主机连通性测试，效果如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v("\n\nCentOS7-Node1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SUCCESS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ansible_facts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"discovered_interpreter_python"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/python"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(", \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false, \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ping"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pong"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("这样就说明我们的主机是连通状态的。接下来的操作才可以正常进行。")]),s._v(" "),a("h3",{attrs:{id:"_2-command-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-command-模块"}},[s._v("#")]),s._v(" 2）command 模块")]),s._v(" "),a("p",[s._v("command 模块为默认模块，所以"),a("code",[s._v("-m command")]),s._v("可以不写\n这个模块可以直接在远程主机上执行命令，并将结果返回本主机。\n举例如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uptime'")]),s._v("\n\nCentOS7-Node1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":40:02 up  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":33,  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" user,  load average: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v('命令模块接受命令名称，后面是空格分隔的列表参数。给定的命令将在所有选定的节点上执行。它不会通过shell进行处理，比如$HOME和操作如"<"，">"，"|"，";"，"&" 工作（需要使用（shell）模块实现这些功能）。注意，该命令不支持'),a("code",[s._v("|")]),s._v(" 管道命令。")]),s._v(" "),a("p",[s._v("下面来看一看该模块下常用的几个命令：")]),s._v(" "),a("blockquote",[a("p",[s._v("chdir # 在执行命令之前，先切换到该目录\nexecutable # 切换shell来执行命令，需要使用命令的绝对路径\nfree_form # 要执行的Linux指令，一般使用Ansible的-a参数代替。\ncreates # 一个文件名，当这个文件存在，则该命令不执行\nremoves # 一个文件名，当这个文件不存在，则该命令不执行")])]),s._v(" "),a("p",[s._v("下面我们来看看这些命令的执行效果：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先切换到 /tmp/ 目录，再执行 touch a.txt b.txt c.txt 命令")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chdir=/tmp/ touch a.txt b.txt c.txt'")]),s._v("\n\nCentOS7-Node1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果 /tmp/a.txt 存在，则不执行 touch d.txt 命令")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chdir=/tmp/ creates=/tmp/a.txt touch d.txt'")]),s._v("\n\nCentOS7-Node1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SUCCESS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\nskipped, since /tmp/a.txt exists\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果 /tmp/a.txt 存在，则执行 rm -rf a.txt b.txt c.txt d.txt 命令")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chdir=/tmp/ removes=/tmp/a.txt rm -rf a.txt b.txt c.txt d.txt'")]),s._v("\n\nCentOS7-Node1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"_3-shell-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-shell-模块"}},[s._v("#")]),s._v(" 3）shell 模块")]),s._v(" "),a("p",[s._v("shell模块可以在远程主机上调用shell解释器运行命令，支持shell的各种功能，例如管道等。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进程数量")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ps -aux | wc -l'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果密钥不存在则生成密钥")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"ssh-keygen -f ~/.ssh/id_rsa -N '' creates=~/.ssh/id_rsa\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当存在 unzip 命令时才执行解压操作")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upzip xx.zip removes=/bin/unzip"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("只要是我们的shell命令，都可以通过这个模块在远程主机上运行，这里就不一一举例了。")]),s._v(" "),a("blockquote",[a("p",[s._v("注: 使用"),a("code",[s._v("command")]),s._v("模块和"),a("code",[s._v("shell")]),s._v("模块必须执行非交互式命令，不可执行交互式命令，比如"),a("code",[s._v("vim")]),s._v(","),a("code",[s._v("top")]),s._v("等。")])]),s._v(" "),a("h3",{attrs:{id:"_4-copy-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-copy-模块"}},[s._v("#")]),s._v(" 4）copy 模块")]),s._v(" "),a("p",[s._v("这个模块用于将文件复制到远程主机，同时支持给定内容生成文件和修改权限等。\n　　其相关选项如下：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("src")]),s._v(' # 被复制到远程主机的本地文件。可以是绝对路径，也可以是相对路径。如果路径是一个目录，则会递归复制，用法类似于"rsync"\n'),a("code",[s._v("content")]),s._v(' # 用于替换"src"，可以直接指定文件的值\n'),a("code",[s._v("dest")]),s._v(" # 必选项，将源文件复制到的远程主机的"),a("strong",[s._v("绝对路径")]),s._v(" "),a("code",[s._v("backup")]),s._v(" # 当文件内容发生改变后，在覆盖之前把源文件备份，备份文件包含时间信息\n"),a("code",[s._v("directory_mode")]),s._v(" # 递归设定目录的权限，默认为系统默认权限\n"),a("code",[s._v("force")]),s._v(' # 当目标主机包含该文件，但内容不同时，设为"yes"，表示强制覆盖；设为"no"，表示目标主机的目标位置不存在该文件才复制。默认为"yes"\n'),a("code",[s._v("others")]),s._v(" # 所有的 file 模块中的选项可以在这里使用")])]),s._v(" "),a("p",[s._v("用法举例如下：")]),s._v(" "),a("h4",{attrs:{id:"复制文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复制文件"}},[s._v("#")]),s._v(" 复制文件：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" AAA "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ./temp.txt\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m copy -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'src=./temp.txt dest=/tmp/temp123.txt mode=666'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /tmp/temp123.txt'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f ./temp.txt\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path=/tmp/temp123.txt state=absent'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"给定内容生成文件-并制定权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给定内容生成文件-并制定权限"}},[s._v("#")]),s._v(" 给定内容生成文件，并制定权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m copy -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'content=\"I am Lzpeng\" dest=/tmp/temp123.txt mode=666'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /tmp/temp123.txt'")]),s._v("\n\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path=/tmp/temp123.txt state=absent'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_5-file-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-file-模块"}},[s._v("#")]),s._v(" 5）file 模块")]),s._v(" "),a("p",[s._v("该模块主要用于设置文件的属性，比如创建文件、创建链接文件、删除文件等。\n下面是一些常见的命令：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("force")]),s._v(" # 需要在两种情况下强制创建软链接，一种是源文件不存在，但之后会建立的情况下；另一种是目标软链接已存在，需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no\n"),a("code",[s._v("group")]),s._v(" # 定义文件/目录的属组。后面可以加上"),a("code",[s._v("mode")]),s._v("：定义文件/目录的权限\n"),a("code",[s._v("owner")]),s._v(" # 定义文件/目录的属主。后面必须跟上"),a("code",[s._v("path")]),s._v("：定义文件/目录的路径\n"),a("code",[s._v("recurse")]),s._v(" # 递归设置文件的属性，只对目录有效，后面跟上"),a("code",[s._v("src")]),s._v("：被链接的源文件路径，只应用于"),a("code",[s._v("state=link")]),s._v("的情况\n"),a("code",[s._v("dest")]),s._v(" # 被链接到的路径，只应用于"),a("code",[s._v("state=link")]),s._v("的情况\n"),a("code",[s._v("state")]),s._v(" # 状态，有以下选项：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("directory")]),s._v("： # 如果目录不存在，就创建目录\n"),a("code",[s._v("file")]),s._v("： # 即使文件不存在，也不会被创建\n"),a("code",[s._v("link")]),s._v("： # 创建软链接\n"),a("code",[s._v("hard")]),s._v("： # 创建硬链接\n"),a("code",[s._v("touch")]),s._v("： # 如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间\n"),a("code",[s._v("absent")]),s._v("： # 删除目录、文件或者取消链接文件")])])]),s._v(" "),a("p",[s._v("用法举例如下：")]),s._v(" "),a("h4",{attrs:{id:"创建目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录"}},[s._v("#")]),s._v(" 创建目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path=/tmp/tmp-dir state=directory'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /tmp | grep tmp-dir'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"创建空文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建空文件"}},[s._v("#")]),s._v(" 创建空文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path=/tmp/tmp-dir/b.txt state=touch'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /tmp/tmp-dir/b.txt'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"创建链接文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建链接文件"}},[s._v("#")]),s._v(" 创建链接文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path=/tmp/tmp-dir/a.txt src=/tmp/tmp-dir/b.txt state=link'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /tmp/tmp-dir/a.txt'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"删除文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除文件"}},[s._v("#")]),s._v(" 删除文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'path=/tmp/tmp-dir state=absent'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls -l /tmp/tmp-dir'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_6-fetch-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-fetch-模块"}},[s._v("#")]),s._v(" 6）fetch 模块")]),s._v(" "),a("p",[s._v("该模块用于从远程某主机获取（复制）文件到本地。\n有两个选项：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("dest")]),s._v("：用来存放文件的目录\n"),a("code",[s._v("src")]),s._v("：在远程拉取的文件，并且必须是一个"),a("strong",[s._v("file")]),s._v("，不能是"),a("strong",[s._v("目录")])])]),s._v(" "),a("p",[s._v("具体举例如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m fetch -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'src=/etc/hostname dest=./'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_7-cron-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-cron-模块"}},[s._v("#")]),s._v(" 7）cron 模块")]),s._v(" "),a("p",[s._v("该模块适用于管理"),a("code",[s._v("cron")]),s._v("计划任务的。\n其使用的语法跟我们的"),a("code",[s._v("crontab")]),s._v("文件中的语法一致，同时，可以指定以下选项：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("day")]),s._v(" # 日应该运行的工作( 1-31, *, */2, )\n"),a("code",[s._v("hour")]),s._v(" # 小时 ( 0-23, *, */2, )\n"),a("code",[s._v("minute")]),s._v(" #分钟( 0-59, *, */2, )\n"),a("code",[s._v("month")]),s._v(" # 月( 1-12, *, /2, )\n"),a("code",[s._v("weekday")]),s._v(" # 周 ( 0-6 for Sunday-Saturday,, )\n"),a("code",[s._v("job")]),s._v(" # 指明运行的命令是什么\n"),a("code",[s._v("name")]),s._v(" # 定时任务描述\n"),a("code",[s._v("reboot")]),s._v(" # 任务在重启时运行，不建议使用，建议使用special_time\n"),a("code",[s._v("special_time")]),s._v(" # 特殊的时间范围，参数：reboot（重启时），annually（每年），monthly（每月），weekly（每周），daily（每天），hourly（每小时）\n"),a("code",[s._v("state")]),s._v(" # 指定状态，present表示添加定时任务，也是默认设置，absent表示删除定时任务\n"),a("code",[s._v("user")]),s._v(" # 以哪个用户的身份执行")])]),s._v(" "),a("p",[s._v("举例如下：")]),s._v(" "),a("h4",{attrs:{id:"添加计划任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加计划任务"}},[s._v("#")]),s._v(" 添加计划任务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'name="ntp update every 5 min" minute=*/5 job="/sbin/ntpdate 172.17.0.1 &> /dev/null"\'')]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crontab -l'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"删除计划任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除计划任务"}},[s._v("#")]),s._v(" 删除计划任务")]),s._v(" "),a("p",[s._v("如果我们的计划任务添加错误，想要删除的话，则执行以下操作：\n首先我们查看一下现有的计划任务：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crontab -l'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cron")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'name="df everyday" hour=15 job="df -lh >> /tmp/disk_total &> /dev/null" state=absent\'')]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crontab -l'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_8-yum-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-yum-模块"}},[s._v("#")]),s._v(" 8）yum 模块")]),s._v(" "),a("p",[s._v("顾名思义，该模块主要用于软件的安装。\n其选项如下：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("name")]),s._v(" # 所安装的包的名称\n"),a("code",[s._v("state=")]),s._v(" # "),a("code",[s._v("present")]),s._v("---\x3e安装， "),a("code",[s._v("latest")]),s._v("---\x3e安装最新的(升级), "),a("code",[s._v("absent")]),s._v("---\x3e 卸载软件。\n"),a("code",[s._v("update_cache")]),s._v(" # 强制更新yum的缓存\n"),a("code",[s._v("conf_file")]),s._v(" # 指定远程yum安装时所依赖的配置文件（安装本地已有的包）。\n"),a("code",[s._v("disable_pgp_check")]),s._v(" # 是否禁止GPG checking，只用于"),a("code",[s._v("present")]),s._v("or "),a("code",[s._v("latest")]),s._v("。\n"),a("code",[s._v("disablerepo")]),s._v(" # 临时禁止使用yum库。 只用于安装或更新时。\n"),a("code",[s._v("enablerepo")]),s._v(" # 临时使用的yum库。只用于安装或更新时。")])]),s._v(" "),a("p",[s._v("下面我们就来安装一个包试试看：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m yum -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=httpd state=present'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_9-service-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-service-模块"}},[s._v("#")]),s._v(" 9）service 模块")]),s._v(" "),a("p",[s._v("该模块用于服务程序的管理。\n其主要选项如下：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("arguments")]),s._v(" # 命令行提供额外的参数\n"),a("code",[s._v("enabled")]),s._v(" # 设置开机启动。\n"),a("code",[s._v("name")]),s._v(" #服务名称\n"),a("code",[s._v("runlevel")]),s._v(" # 开机启动的级别，一般不用指定。\n"),a("code",[s._v("sleep")]),s._v(" # 在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。(定义在剧本中。)\n"),a("code",[s._v("state")]),s._v(" # 有四种状态，分别为："),a("code",[s._v("started")]),s._v("---\x3e启动服务， "),a("code",[s._v("stopped")]),s._v("---\x3e停止服务， "),a("code",[s._v("restarted")]),s._v("---\x3e重启服务， "),a("code",[s._v("reloaded")]),s._v("---\x3e重载配置")])]),s._v(" "),a("p",[s._v("下面是一些例子：")]),s._v(" "),a("h4",{attrs:{id:"开启服务并设置自启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启服务并设置自启动"}},[s._v("#")]),s._v(" 开启服务并设置自启动")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=nginx state=started enabled=true'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试端口")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ss -ntl'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"关闭服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭服务"}},[s._v("#")]),s._v(" 关闭服务")]),s._v(" "),a("p",[s._v("我们也可以通过该模块来关闭我们的服务：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=nginx state=stopped'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试端口")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ss -ntl'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_10-user-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-user-模块"}},[s._v("#")]),s._v(" 10）user 模块")]),s._v(" "),a("p",[s._v("该模块主要是用来管理用户账号。\n其主要选项如下：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("comment")]),s._v(" # 用户的描述信息\n"),a("code",[s._v("createhome")]),s._v(" # 是否创建家目录\n"),a("code",[s._v("force")]),s._v(" # 在使用state=absent时, 行为与userdel –force一致.\n"),a("code",[s._v("group")]),s._v(" # 指定基本组\n"),a("code",[s._v("groups")]),s._v(" # 指定附加组，如果指定为(groups=)表示删除所有组\n"),a("code",[s._v("home")]),s._v(" # 指定用户家目录\n"),a("code",[s._v("move_home")]),s._v(" # 如果设置为home=时, 试图将用户主目录移动到指定的目录\n"),a("code",[s._v("name")]),s._v(" # 指定用户名\n"),a("code",[s._v("non_unique")]),s._v(" # 该选项允许改变非唯一的用户ID值\n"),a("code",[s._v("password")]),s._v(" # 指定用户密码\n"),a("code",[s._v("remove")]),s._v(" # 在使用state=absent时, 行为是与userdel –remove一致\n"),a("code",[s._v("shell")]),s._v(" # 指定默认shell\n"),a("code",[s._v("state")]),s._v(" # 设置帐号状态，不指定为创建，指定值为absent表示删除\n"),a("code",[s._v("system")]),s._v(" # 当创建一个用户，设置这个用户是系统用户。这个设置不能更改现有用户\n"),a("code",[s._v("uid")]),s._v(" # 指定用户的uid")])]),s._v(" "),a("p",[s._v("举例如下：")]),s._v(" "),a("h4",{attrs:{id:"添加一个用户并指定其-uid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加一个用户并指定其-uid"}},[s._v("#")]),s._v(" 添加一个用户并指定其 uid")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m user -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=tuser1 uid=10001'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /etc/passwd | grep tuser1'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"添加一个用户并指定其-密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加一个用户并指定其-密码"}},[s._v("#")]),s._v(" 添加一个用户并指定其 密码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m user -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"name=tuser2 password={{'123456' | password_hash('sha512')}}\"")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /etc/passwd | grep tuser2'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"删除用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除用户"}},[s._v("#")]),s._v(" 删除用户")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# remove 控制是否删除家目录 邮箱")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m user -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=tuser1 state=absent remove=true'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /etc/passwd | grep tuser1'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_11-group-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-group-模块"}},[s._v("#")]),s._v(" 11）group 模块")]),s._v(" "),a("p",[s._v("该模块主要用于添加或删除组。\n常用的选项如下：")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("gid")]),s._v(" # 设置组的GID号\n"),a("code",[s._v("name")]),s._v(" # 指定组的名称\n"),a("code",[s._v("state")]),s._v(" # 指定组的状态，默认为创建，设置值为"),a("code",[s._v("absent")]),s._v("为删除\n"),a("code",[s._v("system")]),s._v(" # 设置值为"),a("code",[s._v("yes")]),s._v("，表示创建为系统组")])]),s._v(" "),a("p",[s._v("举例如下：")]),s._v(" "),a("h4",{attrs:{id:"创建组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建组"}},[s._v("#")]),s._v(" 创建组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m group -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=sanguo gid=12222'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /etc/group | grep 12222'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"删除组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除组"}},[s._v("#")]),s._v(" 删除组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m group -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=sanguo state=absent'")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat /etc/group | grep 12222'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_12-script-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-script-模块"}},[s._v("#")]),s._v(" 12）script 模块")]),s._v(" "),a("p",[s._v("该模块用于将本机的脚本在被管理端的机器上运行。\n该模块直接指定脚本的路径即可，我们通过例子来看一看到底如何使用的：\n首先，我们写一个脚本，并给其加上执行权限：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ./test.sh\t\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash\t")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/current_date.log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -lh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /tmp/disk_total.log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/current_date.log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/disk_total.log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /tmp/current_date.log /tmp/disk_total.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("然后，我们直接运行命令来实现在被管理端执行该脚本：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m script -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./test.sh'")]),s._v("\n\nCentOS7-Node1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" CHANGED "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changed"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" true, \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rc"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stderr"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Shared connection to centos7-node1 closed.'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stderr_lines"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Shared connection to centos7-node1 closed."')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stdout"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021年 10月 17日 星期日 22:29:33 CST'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("文件系统                 容量  已用  可用 已用% 挂载点"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("devtmpfs                 475M     0  475M    0% /dev"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("tmpfs                    487M     0  487M    0% /dev/shm"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("tmpfs                    487M  7.7M  479M    2% /run"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("tmpfs                    487M     0  487M    0% /sys/fs/cgroup"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("/dev/mapper/centos-root   17G  1.4G   16G    9% /"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("/dev/sda1               1014M  138M  877M   14% /boot"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("tmpfs                     98M     0   98M    0% /run/user/0"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(", \n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stdout_lines"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021年 10月 17日 星期日 22:29:33 CST"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"文件系统                 容量  已用  可用 已用% 挂载点"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"devtmpfs                 475M     0  475M    0% /dev"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs                    487M     0  487M    0% /dev/shm"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs                    487M  7.7M  479M    2% /run"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs                    487M     0  487M    0% /sys/fs/cgroup"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/mapper/centos-root   17G  1.4G   16G    9% /"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dev/sda1               1014M  138M  877M   14% /boot"')]),s._v(", \n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tmpfs                     98M     0   98M    0% /run/user/0"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("可以看出已经执行成功了。")]),s._v(" "),a("h3",{attrs:{id:"_13-setup-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-setup-模块"}},[s._v("#")]),s._v(" 13）setup 模块")]),s._v(" "),a("p",[s._v("该模块主要用于收集信息，是通过调用facts组件来实现的。\nfacts组件是Ansible用于采集被管机器设备信息的一个功能，我们可以使用setup模块查机器的所有facts信息，可以使用filter来查看指定信息。整个facts信息被包装在一个JSON格式的数据结构中，ansible_facts是最上层的值。\nfacts就是变量，内建变量 。每个主机的各种信息，cpu颗数、内存大小等。会存在facts中的某个变量中。调用后返回很多对应主机的信息，在后面的操作中可以根据不同的信息来做不同的操作。如redhat系列用yum安装，而debian系列用apt来安装软件。")]),s._v(" "),a("h4",{attrs:{id:"查看信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看信息"}},[s._v("#")]),s._v(" 查看信息")]),s._v(" "),a("p",[s._v("我们可以直接用命令获取到变量的值，具体我们来看看例子：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有信息")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m setup\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 过滤 filter 支持*通配符")]),s._v("\nansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m setup -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=\"*mem*\"'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"保存信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存信息"}},[s._v("#")]),s._v(" 保存信息")]),s._v(" "),a("p",[s._v("我们的setup模块还有一个很好用的功能就是可以保存我们所筛选的信息至我们的主机上，同时，文件名为我们被管制的主机的IP，这样方便我们知道是哪台机器出的问题。\n我们可以看一看例子：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ansible "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" -m setup -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'filter=\"*mem*\"'")]),s._v(" --tree /tmp/facts\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后我们可以去查看一下：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp/facts/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"其他模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他模块"}},[s._v("#")]),s._v(" 其他模块")]),s._v(" "),a("p",[s._v("lineinfile\nreplace\nyum_repository\nlvg(依赖 yum lvm2)\nlvol\nparted\nfilesystem")])])}),[],!1,null,null,null);t.default=n.exports}}]);