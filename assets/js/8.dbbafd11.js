(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{537:function(s,t,a){s.exports=a.p+"assets/img/image-20200404094800622.cebaa87a.png"},538:function(s,t,a){s.exports=a.p+"assets/img/image-20210609000002940.7f42ba91.png"},539:function(s,t,a){s.exports=a.p+"assets/img/2232696-20210621233106024-1676033717.2c20994f.png"},540:function(s,t,a){s.exports=a.p+"assets/img/2232696-20210621233130477-111035427.9597c3d0.png"},541:function(s,t,a){s.exports=a.p+"assets/img/2232696-20210621233157075-1117518703.2dccb1db.png"},618:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[e("a",{attrs:{href:"https://gitee.com/yooome/golang/blob/main/k8s%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/Kubernetes%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B.md#2-kubernetes%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文链接"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://www.bilibili.com/video/BV1Qv41167ck",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频教程"),e("OutboundLink")],1)]),s._v(" "),e("h1",{attrs:{id:"_2-kubernetes集群环境搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-kubernetes集群环境搭建"}},[s._v("#")]),s._v(" 2. kubernetes集群环境搭建")]),s._v(" "),e("h2",{attrs:{id:"_2-1-前置知识点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-前置知识点"}},[s._v("#")]),s._v(" 2.1 前置知识点")]),s._v(" "),e("p",[s._v("目前生产部署Kubernetes 集群主要有两种方式：")]),s._v(" "),e("p",[e("strong",[s._v("kubeadm")])]),s._v(" "),e("p",[s._v("Kubeadm 是一个K8s 部署工具，提供"),e("code",[s._v("kubeadm init")]),s._v(" 和"),e("code",[s._v("kubeadm join")]),s._v("，用于快速部署Kubernetes 集群。")]),s._v(" "),e("p",[s._v("官方地址："),e("a",{attrs:{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("strong",[s._v("二进制包")])]),s._v(" "),e("p",[s._v("从github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes 集群。")]),s._v(" "),e("p",[s._v("Kubeadm 降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，推荐使用二进制包部署Kubernetes 集群，虽然手动部署麻烦点，期间可以学习很多工作原理，也利于后期维护。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(537),alt:"image-20200404094800622"}})]),s._v(" "),e("h2",{attrs:{id:"_2-2-kubeadm-部署方式介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-kubeadm-部署方式介绍"}},[s._v("#")]),s._v(" 2.2 kubeadm 部署方式介绍")]),s._v(" "),e("p",[s._v("kubeadm 是官方社区推出的一个用于快速部署kubernetes 集群的工具，这个工具能通过两条指令完成一个kubernetes 集群的部署：")]),s._v(" "),e("ul",[e("li",[s._v("创建一个Master 节点"),e("code",[s._v("kubeadm init")])]),s._v(" "),e("li",[s._v("将Node 节点加入到当前集群中"),e("code",[s._v("kubeadm join <Master 节点的IP 和端口>")])])]),s._v(" "),e("h2",{attrs:{id:"_2-3-安装要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装要求"}},[s._v("#")]),s._v(" 2.3 安装要求")]),s._v(" "),e("p",[s._v("在开始之前，部署Kubernetes 集群机器需要满足以下几个条件：")]),s._v(" "),e("ul",[e("li",[s._v("一台或多台机器，操作系统CentOS7.x-86_x64")]),s._v(" "),e("li",[s._v("硬件配置：2GB 或更多RAM，2 个CPU 或更多CPU，硬盘30GB 或更多")]),s._v(" "),e("li",[s._v("集群中所有机器之间网络互通")]),s._v(" "),e("li",[s._v("可以访问外网，需要拉取镜像")]),s._v(" "),e("li",[s._v("禁止swap 分区")])]),s._v(" "),e("h2",{attrs:{id:"_2-4-最终目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-最终目标"}},[s._v("#")]),s._v(" 2.4 最终目标")]),s._v(" "),e("ul",[e("li",[s._v("在所有节点上安装Docker 和kubeadm")]),s._v(" "),e("li",[s._v("部署Kubernetes Master")]),s._v(" "),e("li",[s._v("部署容器网络插件")]),s._v(" "),e("li",[s._v("部署Kubernetes Node，将节点加入Kubernetes 集群中")]),s._v(" "),e("li",[s._v("部署Dashboard Web 页面，可视化查看Kubernetes 资源")])]),s._v(" "),e("h2",{attrs:{id:"_2-5-准备环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-准备环境"}},[s._v("#")]),s._v(" 2.5 准备环境")]),s._v(" "),e("p",[e("img",{attrs:{src:a(538),alt:"image-20210609000002940"}})]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[s._v("角色")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("IP地址")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("组件")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("master01")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.5.3")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("node01")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.5.4")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("node02")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.5.5")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("docker，kubectl，kubeadm，kubelet")])])])]),s._v(" "),e("h2",{attrs:{id:"_2-6-环境初始化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-环境初始化"}},[s._v("#")]),s._v(" 2.6 环境初始化")]),s._v(" "),e("h3",{attrs:{id:"_2-6-1-检查操作系统的版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-1-检查操作系统的版本"}},[s._v("#")]),s._v(" 2.6.1 检查操作系统的版本")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此方式下安装kubernetes集群要求Centos版本要在7.5或之上")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redhat"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("release\nCentOS Linux release 7"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("9"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("2009 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Core"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_2-6-2-主机名解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-2-主机名解析"}},[s._v("#")]),s._v(" 2.6.2 主机名解析")]),s._v(" "),e("p",[s._v("为了方便集群节点间的直接调用，在这个配置一下主机名解析，企业中推荐使用内部DNS服务器")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机名成解析 编辑三台服务器的/etc/hosts文件，添加下面内容")]),s._v("\n192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("90"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("100 master\n192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("90"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("106 node1\n192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("90"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("107 node2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_2-6-3-时间同步"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-3-时间同步"}},[s._v("#")]),s._v(" 2.6.3 时间同步")]),s._v(" "),e("p",[s._v("kubernetes要求集群中的节点时间必须精确一直，这里使用chronyd服务从网络同步时间")]),s._v(" "),e("p",[s._v("企业中建议配置内部的会见同步服务器")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动chronyd服务")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start chronyd")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable chronyd")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# date")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"_2-6-4-禁用iptable和firewalld服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-4-禁用iptable和firewalld服务"}},[s._v("#")]),s._v(" 2.6.4  禁用iptable和firewalld服务")]),s._v(" "),e("p",[s._v("kubernetes和docker 在运行的中会产生大量的iptables规则，为了不让系统规则跟它们混淆，直接关闭系统的规则")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 关闭firewalld服务")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop firewalld")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl disable firewalld")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 关闭iptables服务")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop iptables")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl disable iptables")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"_2-6-5-禁用selinux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-5-禁用selinux"}},[s._v("#")]),s._v(" 2.6.5 禁用selinux")]),s._v(" "),e("p",[s._v("selinux是linux系统一下的一个安全服务，如果不关闭它，在安装集群中会产生各种各样的奇葩问题")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 /etc/selinux/config 文件，修改SELINUX的值为disable")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改完毕之后需要重启linux服务")]),s._v("\nSELINUX=disabled\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_2-6-6-禁用swap分区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-6-禁用swap分区"}},[s._v("#")]),s._v(" 2.6.6 禁用swap分区")]),s._v(" "),e("p",[s._v("swap分区值的是虚拟内存分区，它的作用是物理内存使用完，之后将磁盘空间虚拟成内存来使用，启用sqap设备会对系统的性能产生非常负面的影响，因此kubernetes要求每个节点都要禁用swap设备，但是如果因为某些原因确实不能关闭swap分区，就需要在集群安装过程中通过明确的参数进行配置说明")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑分区配置文件/etc/fstab，注释掉swap分区一行")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意修改完毕之后需要重启linux服务")]),s._v("\nvim "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("fstab\n注释掉 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dev"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mapper"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("centos"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("swap swap\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /dev/mapper/centos-swap swap")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-6-7-修改linux的内核参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-7-修改linux的内核参数"}},[s._v("#")]),s._v(" 2.6.7 修改linux的内核参数")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改linux的内核采纳数，添加网桥过滤和地址转发功能")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑/etc/sysctl.d/kubernetes.conf文件，添加如下配置：")]),s._v("\nnet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nf"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("call"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ip6tables = 1\nnet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bridge"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nf"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("call"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("iptables = 1\nnet"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ipv4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip_forward = 1\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -p")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载网桥过滤模块")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# modprobe br_netfilter")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看网桥过滤模块是否加载成功")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsmod | grep br_netfilter")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"_2-6-8-配置ipvs功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-8-配置ipvs功能"}},[s._v("#")]),s._v(" 2.6.8 配置ipvs功能")]),s._v(" "),e("p",[s._v("在Kubernetes中Service有两种带来模型，一种是基于iptables的，一种是基于ipvs的两者比较的话，ipvs的性能明显要高一些，但是如果要使用它，需要手动载入ipvs模块")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.安装ipset和ipvsadm")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install ipset ipvsadmin -y")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.添加需要加载的模块写入脚本文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat <<EOF> /etc/sysconfig/modules/ipvs.modules")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\nmodprobe "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs\nmodprobe "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs_rr\nmodprobe "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs_wrr\nmodprobe "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" ip_vs_sh\nmodprobe "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" nf_conntrack_ipv4\nEOF\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.为脚本添加执行权限")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /etc/sysconfig/modules/ipvs.modules")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4.执行脚本文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /bin/bash /etc/sysconfig/modeules/ipvs.modules")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5.查看对应的模块是否加载成功")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsmod | grep -e -ip_vs -e nf_conntrack_ipv4")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"_2-6-9-安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-9-安装docker"}},[s._v("#")]),s._v(" 2.6.9 安装docker")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、切换镜像源")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d.docker-ce.repo")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、查看当前镜像源中支持的docker版本")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum list docker-ce --showduplicates")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、安装特定版本的docker-ce")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须制定--setopt=obsoletes=0，否则yum会自动安装更高版本")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.e17 -y")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、添加一个配置文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Docker 在默认情况下使用Vgroup Driver为cgroupfs，而Kubernetes推荐使用systemd来替代cgroupfs")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /etc/docker")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat <<EOF> /etc/docker/daemon.json")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),s._v(": "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),s._v(": "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://kn0t2bca.mirror.aliyuncs.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、启动dokcer")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart docker")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable docker")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("h3",{attrs:{id:"_2-6-10-安装kubernetes组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-10-安装kubernetes组件"}},[s._v("#")]),s._v(" 2.6.10 安装Kubernetes组件")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1、由于kubernetes的镜像在国外，速度比较慢，这里切换成国内的镜像源")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2、编辑/etc/yum.repos.d/kubernetes.repo,添加下面的配置")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[kubernetes]")]),s._v("\nname=Kubernetes\nbaseurl=http:"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirror"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("repos"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("el7"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("x86_64\nenabled=1\ngpgchech=0\nrepo_gpgcheck=0\ngpgkey=http:"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg\n\t\t\thttp:"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mirrors"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyun"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rpm"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("package"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gpg\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3、安装kubeadm、kubelet和kubectl")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4、配置kubelet的cgroup")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑/etc/sysconfig/kubelet, 添加下面的配置")]),s._v("\nKUBELET_CGROUP_ARGS="),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--cgroup-driver=systemd"')]),s._v("\nKUBE_PROXY_MODE="),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ipvs"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5、设置kubelet开机自启")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kubelet")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("h3",{attrs:{id:"_2-6-11-准备集群镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-11-准备集群镜像"}},[s._v("#")]),s._v(" 2.6.11 准备集群镜像")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在安装kubernetes集群之前，必须要提前准备好集群需要的镜像，所需镜像可以通过下面命令查看")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm config images list")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载镜像")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此镜像kubernetes的仓库中，由于网络原因，无法连接，下面提供了一种替换方案")]),s._v("\nimages="),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tkube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver:v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n\tkube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("controller"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager:v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n\tkube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("scheduler:v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n\tkube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy:v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n\tpause:3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1\n\tetcd:3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("3"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("0\n\tcoredns:1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("6"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("5\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" imageName in $"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("images"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n\tdocker pull registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n\tdocker tag registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" k8s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gcr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n\tdocker rmi registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hangzhou"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" \ndone\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("h3",{attrs:{id:"_2-6-11-集群初始化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-11-集群初始化"}},[s._v("#")]),s._v(" 2.6.11 集群初始化")]),s._v(" "),e("blockquote",[e("p",[s._v("下面的操作只需要在master节点上执行即可")])]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建集群")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm init ")]),s._v("\n\t"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("apiserver"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address=192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("90"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("100 \n\t"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("repository registry"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("google_containers \n\t"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4 \n\t"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("service"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr=10"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("96"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("12 \n\t"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("pod"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("network"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr=10"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("244"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("16\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建必要文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -p $HOME/.kube")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo chown $(id -u):$(id -g) $HOME/.kube/config")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("blockquote",[e("p",[s._v("下面的操作只需要在node节点上执行即可")])]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("kubeadm join 192"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("168"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("100:6443 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("token awk15p"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t6bamck54w69u4s8 \\\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("discovery"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hash sha256:a94fa09562466d32d29523ab6cff122186f1127599fa4dcd5fa0152694f17117 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("在master上查看节点信息")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME    STATUS   ROLES     AGE   VERSION\nmaster  NotReady  master   6m    v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\nnode1   NotReady   <none>  22s   v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\nnode2   NotReady   <none>  19s   v1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("17"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("4\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-6-13-安装网络插件-只在master节点操作即可"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-13-安装网络插件-只在master节点操作即可"}},[s._v("#")]),s._v(" 2.6.13 安装网络插件，只在master节点操作即可")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("wget https:"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("raw"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("githubusercontent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("coreos"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Documentation"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("由于外网不好访问，如果出现无法访问的情况，可以直接用下面的 记得文件名是kube-flannel.yml，位置：/root/kube-flannel.yml内容：")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("https:"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("io"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("flannel"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tree"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Documentation"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("kube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("![截屏2021-10-01 下午10.23.00](images/截屏2021-10-01 下午10.23.00.png)")]),s._v(" "),e("h3",{attrs:{id:"_2-6-14-使用kubeadm-reset重置集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-14-使用kubeadm-reset重置集群"}},[s._v("#")]),s._v(" 2.6.14 使用kubeadm reset重置集群")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#在master节点之外的节点进行操作\nkubeadm reset\nsystemctl stop kubelet\nsystemctl stop docker\nrm -rf /var/lib/cni/\nrm -rf /var/lib/kubelet/*\nrm -rf /etc/cni/\nifconfig cni0 down\nifconfig flannel.1 down\nifconfig docker0 down\nip link delete cni0\nip link delete flannel.1\n##重启kubelet\nsystemctl restart kubelet\n##重启docker\nsystemctl restart docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"_2-6-15-重启kubelet和docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-15-重启kubelet和docker"}},[s._v("#")]),s._v(" 2.6.15 重启kubelet和docker")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启kubelet")]),s._v("\nsystemctl restart kubelet\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启docker")]),s._v("\nsystemctl restart docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("使用配置文件启动fannel")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("kubectl apply "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f kube"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flannel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("等待它安装完毕 发现已经是 集群的状态已经是Ready")]),s._v(" "),e("p",[e("img",{attrs:{src:a(539),alt:"img"}})]),s._v(" "),e("h3",{attrs:{id:"_2-6-16-kubeadm中的命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-16-kubeadm中的命令"}},[s._v("#")]),s._v(" 2.6.16 kubeadm中的命令")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成 新的token")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("[root@master ~]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm token create --print-join-command")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_2-7-集群测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-集群测试"}},[s._v("#")]),s._v(" 2.7 集群测试")]),s._v(" "),e("h3",{attrs:{id:"_2-7-1-创建一个nginx服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-1-创建一个nginx服务"}},[s._v("#")]),s._v(" 2.7.1 创建一个nginx服务")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("kubectl create deployment nginx  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("image=nginx:1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("14"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alpine\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-7-2-暴露端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-2-暴露端口"}},[s._v("#")]),s._v(" 2.7.2 暴露端口")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("kubectl expose deploy nginx  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("port=80 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("target"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port=80  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("type")]),s._v("=NodePort\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-7-3-查看服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-3-查看服务"}},[s._v("#")]),s._v(" 2.7.3 查看服务")]),s._v(" "),e("div",{staticClass:"language-powershell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-powershell"}},[e("code",[s._v("kubectl get pod"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("svc\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-7-4-查看pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-4-查看pod"}},[s._v("#")]),s._v(" 2.7.4 查看pod")]),s._v(" "),e("p",[e("img",{attrs:{src:a(540),alt:"img"}})]),s._v(" "),e("p",[s._v("浏览器测试结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(541),alt:"img"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);