(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{578:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"github-actions-入门教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-入门教程"}},[s._v("#")]),s._v(" GitHub Actions 入门教程")]),s._v(" "),a("h2",{attrs:{id:"一、github-actions-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、github-actions-是什么"}},[s._v("#")]),s._v(" 一、GitHub Actions 是什么？")]),s._v(" "),a("p",[s._v("大家知道，持续集成由很多操作组成，比如抓取代码、运行测试、登录远程服务器，发布到第三方服务等等。GitHub 把这些操作就称为 actions。")]),s._v(" "),a("p",[s._v("很多操作在不同项目里面是类似的，完全可以共享。GitHub 注意到了这一点，想出了一个很妙的点子，允许开发者把每个操作写成独立的脚本文件，存放到代码仓库，使得其他开发者可以引用。")]),s._v(" "),a("p",[s._v("如果你需要某个 action，不必自己写复杂的脚本，直接引用他人写好的 action 即可，整个持续集成过程，就变成了一个 actions 的组合。这就是 GitHub Actions 最特别的地方。")]),s._v(" "),a("p",[s._v("GitHub 做了一个"),a("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方市场"),a("OutboundLink")],1),s._v("，可以搜索到他人提交的 actions。另外，还有一个 "),a("a",{attrs:{href:"https://github.com/sdras/awesome-actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("awesome actions"),a("OutboundLink")],1),s._v(" 的仓库，也可以找到不少 action。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.wangbase.com/blogimg/asset/201909/bg2019091105.jpg",alt:"Actions"}})]),s._v(" "),a("p",[s._v("上面说了，每个 action 就是一个独立脚本，因此可以做成代码仓库，使用"),a("code",[s._v("userName/repoName")]),s._v("的语法引用 action。比如，"),a("code",[s._v("actions/setup-node")]),s._v("就表示"),a("code",[s._v("github.com/actions/setup-node")]),s._v("这个仓库，它代表一个 action，作用是安装 Node.js。事实上，GitHub 官方的 actions 都放在 "),a("a",{attrs:{href:"https://github.com/actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("github.com/actions"),a("OutboundLink")],1),s._v(" 里面。")]),s._v(" "),a("p",[s._v("既然 actions 是代码仓库，当然就有版本的概念，用户可以引用某个具体版本的 action。下面都是合法的 action 引用，用的就是 Git 的指针概念，详见"),a("a",{attrs:{href:"https://help.github.com/en/articles/about-actions#versioning-your-action",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@74bc508 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向一个 commit")]),s._v("\nactions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@v1.0    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向一个标签")]),s._v("\nactions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@master  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向一个分支")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"二、基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、基本概念"}},[s._v("#")]),s._v(" 二、基本概念")]),s._v(" "),a("p",[s._v("GitHub Actions 有一些自己的术语。")]),s._v(" "),a("ul",[a("li",[s._v("workflow （工作流程）：持续集成一次运行的过程，就是一个 workflow。")]),s._v(" "),a("li",[s._v("job （任务）：一个 workflow 由一个或多个 jobs 构成，含义是一次持续集成的运行，可以完成多个任务。")]),s._v(" "),a("li",[s._v("step（步骤）：每个 job 由多个 step 构成，一步步完成。")]),s._v(" "),a("li",[s._v("action （动作）：每个 step 可以依次执行一个或多个命令（action）。")])]),s._v(" "),a("h2",{attrs:{id:"三、workflow-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、workflow-文件"}},[s._v("#")]),s._v(" 三、workflow 文件")]),s._v(" "),a("p",[s._v("GitHub Actions 的配置文件叫做 workflow 文件，存放在代码仓库的"),a("code",[s._v(".github/workflows")]),s._v("目录。")]),s._v(" "),a("p",[s._v("workflow 文件采用 "),a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2016/07/yaml.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("YAML"),a("OutboundLink")],1),s._v(" 格式，文件名可以任意取，但是后缀名统一为"),a("code",[s._v(".yml")]),s._v("，比如"),a("code",[s._v("foo.yml")]),s._v("。一个库可以有多个 workflow 文件。GitHub 只要发现"),a("code",[s._v(".github/workflows")]),s._v("目录里面有"),a("code",[s._v(".yml")]),s._v("文件，就会自动运行该文件。")]),s._v(" "),a("p",[s._v("workflow 文件的配置字段非常多，详见"),a("a",{attrs:{href:"https://help.github.com/en/articles/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。下面是一些基本字段。")]),s._v(" "),a("h3",{attrs:{id:"_1-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-name"}},[s._v("#")]),s._v(" （1）name")]),s._v(" "),a("p",[s._v("name字段是 workflow 的名称。如果省略该字段，默认为当前 workflow 的文件名。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" GitHub Actions Demo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-on"}},[s._v("#")]),s._v(" （2）on")]),s._v(" "),a("p",[a("code",[s._v("on")]),s._v("字段指定触发 workflow 的条件，通常是某些事件。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" push\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("上面代码指定，"),a("code",[s._v("push")]),s._v("事件触发 workflow。")]),s._v(" "),a("p",[a("code",[s._v("on")]),s._v("字段也可以是事件的数组。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pull_request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("上面代码指定，"),a("code",[s._v("push")]),s._v("事件或"),a("code",[s._v("pull_request")]),s._v("事件都可以触发 workflow。")]),s._v(" "),a("p",[s._v("完整的事件列表，请查看"),a("a",{attrs:{href:"https://help.github.com/en/articles/events-that-trigger-workflows",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("。除了代码库事件，GitHub Actions 也支持外部事件触发，或者定时运行。")]),s._v(" "),a("h3",{attrs:{id:"_3-on-push-pull-request-tags-branches"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-on-push-pull-request-tags-branches"}},[s._v("#")]),s._v(" （3）on.<push|pull_request>.<tags|branches>")]),s._v(" "),a("p",[s._v("指定触发事件时，可以限定分支或标签。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("上面代码指定，只有"),a("code",[s._v("master")]),s._v("分支发生"),a("code",[s._v("push")]),s._v("事件时，才会触发 workflow。")]),s._v(" "),a("h3",{attrs:{id:"_4-jobs-job-id-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-jobs-job-id-name"}},[s._v("#")]),s._v(" （4）jobs.<job_id>.name")]),s._v(" "),a("p",[s._v("workflow 文件的主体是"),a("code",[s._v("jobs")]),s._v("字段，表示要执行的一项或多项任务。")]),s._v(" "),a("p",[a("code",[s._v("jobs")]),s._v("字段里面，需要写出每一项任务的"),a("code",[s._v("job_id")]),s._v("，具体名称自定义。"),a("code",[s._v("job_id")]),s._v("里面的"),a("code",[s._v("name")]),s._v("字段是任务的说明。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my_first_job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" My first job\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my_second_job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" My second job\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("上面代码的jobs字段包含两项任务，"),a("code",[s._v("job_id")]),s._v("分别是"),a("code",[s._v("my_first_job")]),s._v("和"),a("code",[s._v("my_second_job")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"_5-jobs-job-id-needs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-jobs-job-id-needs"}},[s._v("#")]),s._v(" （5）jobs.<job_id>.needs")]),s._v(" "),a("p",[a("code",[s._v("needs")]),s._v("字段指定当前任务的依赖关系，即运行顺序。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" job1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("job1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" job2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("上面代码中，"),a("code",[s._v("job1")]),s._v("必须先于"),a("code",[s._v("job2")]),s._v("完成，而"),a("code",[s._v("job3")]),s._v("等待"),a("code",[s._v("job1")]),s._v("和"),a("code",[s._v("job2")]),s._v("的完成才能运行。因此，这个 workflow 的运行顺序依次为："),a("code",[s._v("job1")]),s._v("、"),a("code",[s._v("job2")]),s._v("、"),a("code",[s._v("job3")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"_6-jobs-job-id-runs-on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-jobs-job-id-runs-on"}},[s._v("#")]),s._v(" （6）jobs.<job_id>.runs-on")]),s._v(" "),a("p",[a("code",[s._v("runs-on")]),s._v("字段指定运行所需要的虚拟机环境。它是必填字段。目前可用的虚拟机如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ubuntu-latest，ubuntu-18.04或ubuntu-16.04\nwindows-latest，windows-2019或windows-2016\nmacOS-latest或macOS-10.14\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("下面代码指定虚拟机环境为"),a("code",[s._v("ubuntu-18.04")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_7-jobs-job-id-steps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-jobs-job-id-steps"}},[s._v("#")]),s._v(" （7）jobs.<job_id>.steps")]),s._v(" "),a("p",[a("code",[s._v("steps")]),s._v("字段指定每个 Job 的运行步骤，可以包含一个或多个步骤。每个步骤都可以指定以下三个字段。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[s._v("jobs.<job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".steps.name：步骤名称。\njobs.<job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".steps.run：该步骤运行的命令或者 action。\njobs.<job_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".steps.env：该步骤所需的环境变量。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("下面是一个完整的 workflow 文件的范例。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Greeting from Mona\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" push\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my-job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" My Job\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Print a greeting\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MY_VAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Hi there"),a("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),s._v(" My name is\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FIRST_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Mona\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MIDDLE_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" The\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("LAST_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Octocat\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n        echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("上面代码中，"),a("code",[s._v("steps")]),s._v("字段只包括一个步骤。该步骤先注入四个环境变量，然后执行一条 Bash 命令。")]),s._v(" "),a("h2",{attrs:{id:"四、实例-vuepress-项目发布到-github-pages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、实例-vuepress-项目发布到-github-pages"}},[s._v("#")]),s._v(" 四、实例：VuePress 项目发布到 GitHub Pages")]),s._v(" "),a("p",[s._v("第一步，这个示例需要将构建成果发到 GitHub 仓库，因此需要 GitHub 密钥。按照"),a("a",{attrs:{href:"https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),a("OutboundLink")],1),s._v("，生成一个密钥。然后，将这个密钥储存到当前仓库的"),a("code",[s._v("Settings/Secrets")]),s._v("里面。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.wangbase.com/blogimg/asset/201909/bg2019091107.jpg",alt:"Settings/Secrets"}})]),s._v(" "),a("p",[s._v("上图是储存密钥的环境变量的地方。环境变量的名字可以随便起，这里用的是"),a("code",[s._v("ACCESS_TOKEN")]),s._v("。如果你不用这个名字，后面脚本里的变量名也要跟着改。")]),s._v(" "),a("p",[s._v("第二步，本地计算机使用"),a("code",[s._v("vuepress-theme-reco")]),s._v("，生成一个标准的 vuepress 应用。("),a("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("vuepress-theme-reco官网"),a("OutboundLink")],1),s._v(")")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npx")]),s._v("\nnpx @vuepress-reco/theme-cli init\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @vuepress-reco/theme-cli -g\ntheme-cli init\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" global "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" @vuepress-reco/theme-cli\ntheme-cli init\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("第三步，在这个仓库的"),a("code",[s._v(".github/workflows")]),s._v("目录，生成一个 workflow 文件，名字可以随便取，这个示例是"),a("code",[s._v("build-and-deploy-github-page.yml")]),s._v("。")]),s._v(" "),a("p",[s._v("我们选用一个别人已经写好的 action："),a("a",{attrs:{href:"https://github.com/marketplace/actions/deploy-to-github-pages",target:"_blank",rel:"noopener noreferrer"}},[s._v("JamesIves/github-pages-deploy-action"),a("OutboundLink")],1),s._v("，它提供了 workflow 的范例文件，直接拷贝过来就行了。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build and Deploy Github Page\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" gh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("source\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-and-deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Checkout 🛎️\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/checkout@v2.3.1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persist-credentials")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install and Build\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@v2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'14'")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n        npm install\n        npm run build")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deploy 🚀\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" JamesIves/github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("action@4.1.5\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ACCESS_TOKEN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.ACCESS_TOKEN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("BRANCH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FOLDER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("上面这个 workflow 文件的要点如下。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("整个流程在gh-pages-source分支发生push事件时触发。\n只有一个job，运行在虚拟机环境ubuntu-latest。\n第一步是获取源码，使用的 action 是actions/checkout。\n第二步是构建和部署，使用的 action 是JamesIves/github-pages-deploy-action。\n第二步需要四个环境变量，分别为 GitHub 密钥、发布分支、构建成果所在目录、构建脚本。其中，只有 GitHub 密钥是秘密变量，需要写在双括号里面，其他三个都可以直接写在文件里。\n第五步，保存上面的文件后，将整个仓库推送到 GitHub。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("GitHub 发现了 workflow 文件以后，就会自动运行。你可以在网站上实时查看"),a("a",{attrs:{href:"https://github.com/lzpeng723/lzpeng723.github.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("运行日志"),a("OutboundLink")],1),s._v("，日志默认保存30天")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://www.wangbase.com/blogimg/asset/201909/bg2019091108.jpg",alt:"actions"}})]),s._v(" "),a("p",[s._v("等到 workflow 运行结束，访问 "),a("a",{attrs:{href:"https://lzpeng723.github.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub Page"),a("OutboundLink")],1),s._v("，会看到构建成果已经发上网了。")]),s._v(" "),a("p",[s._v("以后，每次修改后推送源码，GitHub Actions 都会自动运行，将构建产物发布到网页。")]),s._v(" "),a("h3",{attrs:{id:"五、参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、参考链接"}},[s._v("#")]),s._v(" 五、参考链接")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("阮一峰 GitHub Actions 入门教程"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"https://help.github.com/en/categories/automating-your-workflow-with-github-actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub Pages 官方文档"),a("OutboundLink")],1),s._v(" "),a("a",{attrs:{href:"https://lukeboyle.com/blog-posts/2019/08/github-actions-for-web-apps/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github Actions for web apps"),a("OutboundLink")],1),s._v(", Luke Boyle\n"),a("a",{attrs:{href:"https://medium.com/@adam.zolyak/my-first-week-with-github-actions-5d92de4c4851",target:"_blank",rel:"noopener noreferrer"}},[s._v("My First Week With GitHub Actions"),a("OutboundLink")],1),s._v(", Adam Zolyak")])])}),[],!1,null,null,null);t.default=e.exports}}]);