(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{548:function(s,t,a){s.exports=a.p+"assets/img/screts-config.2267dc3d.png"},549:function(s,t,a){s.exports=a.p+"assets/img/actions-run-log.b739f24a.png"},550:function(s,t,a){s.exports=a.p+"assets/img/lzpeng723.github.io.home.e84d0505.png"},680:function(s,t,a){"use strict";a.r(t);var n=a(10),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"github-actions-入门教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-入门教程"}},[s._v("#")]),s._v(" GitHub Actions 入门教程")]),s._v(" "),n("h2",{attrs:{id:"一、github-actions-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、github-actions-是什么"}},[s._v("#")]),s._v(" 一、GitHub Actions 是什么？")]),s._v(" "),n("p",[s._v("大家知道，持续集成由很多操作组成，比如抓取代码、运行测试、登录远程服务器，发布到第三方服务等等。GitHub 把这些操作就称为 actions。")]),s._v(" "),n("p",[s._v("很多操作在不同项目里面是类似的，完全可以共享。GitHub 注意到了这一点，想出了一个很妙的点子，允许开发者把每个操作写成独立的脚本文件，存放到代码仓库，使得其他开发者可以引用。")]),s._v(" "),n("p",[s._v("如果你需要某个 action，不必自己写复杂的脚本，直接引用他人写好的 action 即可，整个持续集成过程，就变成了一个 actions 的组合。这就是 GitHub Actions 最特别的地方。")]),s._v(" "),n("p",[s._v("GitHub 做了一个"),n("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方市场"),n("OutboundLink")],1),s._v("，可以搜索到他人提交的 actions。另外，还有一个 "),n("a",{attrs:{href:"https://github.com/sdras/awesome-actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("awesome actions"),n("OutboundLink")],1),s._v(" 的仓库，也可以找到不少 action。")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://www.wangbase.com/blogimg/asset/201909/bg2019091105.jpg",alt:"Actions"}})]),s._v(" "),n("p",[s._v("上面说了，每个 action 就是一个独立脚本，因此可以做成代码仓库，使用"),n("code",[s._v("userName/repoName")]),s._v("的语法引用 action。比如，"),n("code",[s._v("actions/setup-node")]),s._v("就表示"),n("code",[s._v("github.com/actions/setup-node")]),s._v("这个仓库，它代表一个 action，作用是安装 Node.js。事实上，GitHub 官方的 actions 都放在 "),n("a",{attrs:{href:"https://github.com/actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("github.com/actions"),n("OutboundLink")],1),s._v(" 里面。")]),s._v(" "),n("p",[s._v("既然 actions 是代码仓库，当然就有版本的概念，用户可以引用某个具体版本的 action。下面都是合法的 action 引用，用的就是 Git 的指针概念，详见"),n("a",{attrs:{href:"https://help.github.com/en/articles/about-actions#versioning-your-action",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("actions/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@74bc508 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向一个 commit")]),s._v("\nactions/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@v1.0    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向一个标签")]),s._v("\nactions/setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node@master  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向一个分支")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"二、基本概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、基本概念"}},[s._v("#")]),s._v(" 二、基本概念")]),s._v(" "),n("p",[s._v("GitHub Actions 有一些自己的术语。")]),s._v(" "),n("ul",[n("li",[s._v("workflow （工作流程）：持续集成一次运行的过程，就是一个 workflow。")]),s._v(" "),n("li",[s._v("job （任务）：一个 workflow 由一个或多个 jobs 构成，含义是一次持续集成的运行，可以完成多个任务。")]),s._v(" "),n("li",[s._v("step（步骤）：每个 job 由多个 step 构成，一步步完成。")]),s._v(" "),n("li",[s._v("action （动作）：每个 step 可以依次执行一个或多个命令（action）。")])]),s._v(" "),n("h2",{attrs:{id:"三、workflow-文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、workflow-文件"}},[s._v("#")]),s._v(" 三、workflow 文件")]),s._v(" "),n("p",[s._v("GitHub Actions 的配置文件叫做 workflow 文件，存放在代码仓库的"),n("code",[s._v(".github/workflows")]),s._v("目录。")]),s._v(" "),n("p",[s._v("workflow 文件采用 "),n("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2016/07/yaml.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("YAML"),n("OutboundLink")],1),s._v(" 格式，文件名可以任意取，但是后缀名统一为"),n("code",[s._v(".yml")]),s._v("，比如"),n("code",[s._v("foo.yml")]),s._v("。一个库可以有多个 workflow 文件。GitHub 只要发现"),n("code",[s._v(".github/workflows")]),s._v("目录里面有"),n("code",[s._v(".yml")]),s._v("文件，就会自动运行该文件。")]),s._v(" "),n("p",[s._v("workflow 文件的配置字段非常多，详见"),n("a",{attrs:{href:"https://help.github.com/en/articles/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("。下面是一些基本字段。")]),s._v(" "),n("h3",{attrs:{id:"_1-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-name"}},[s._v("#")]),s._v(" （1）name")]),s._v(" "),n("p",[s._v("name字段是 workflow 的名称。如果省略该字段，默认为当前 workflow 的文件名。")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" GitHub Actions Demo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_2-on"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-on"}},[s._v("#")]),s._v(" （2）on")]),s._v(" "),n("p",[n("code",[s._v("on")]),s._v("字段指定触发 workflow 的条件，通常是某些事件。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" push\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("上面代码指定，"),n("code",[s._v("push")]),s._v("事件触发 workflow。")]),s._v(" "),n("p",[n("code",[s._v("on")]),s._v("字段也可以是事件的数组。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("push"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pull_request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("上面代码指定，"),n("code",[s._v("push")]),s._v("事件或"),n("code",[s._v("pull_request")]),s._v("事件都可以触发 workflow。")]),s._v(" "),n("p",[s._v("完整的事件列表，请查看"),n("a",{attrs:{href:"https://help.github.com/en/articles/events-that-trigger-workflows",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("。除了代码库事件，GitHub Actions 也支持外部事件触发，或者定时运行。")]),s._v(" "),n("h3",{attrs:{id:"_3-on-push-pull-request-tags-branches"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-on-push-pull-request-tags-branches"}},[s._v("#")]),s._v(" （3）on.<push|pull_request>.<tags|branches>")]),s._v(" "),n("p",[s._v("指定触发事件时，可以限定分支或标签。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branches")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("    \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" master\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("上面代码指定，只有"),n("code",[s._v("master")]),s._v("分支发生"),n("code",[s._v("push")]),s._v("事件时，才会触发 workflow。")]),s._v(" "),n("h3",{attrs:{id:"_4-jobs-job-id-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-jobs-job-id-name"}},[s._v("#")]),s._v(" （4）jobs.<job_id>.name")]),s._v(" "),n("p",[s._v("workflow 文件的主体是"),n("code",[s._v("jobs")]),s._v("字段，表示要执行的一项或多项任务。")]),s._v(" "),n("p",[n("code",[s._v("jobs")]),s._v("字段里面，需要写出每一项任务的"),n("code",[s._v("job_id")]),s._v("，具体名称自定义。"),n("code",[s._v("job_id")]),s._v("里面的"),n("code",[s._v("name")]),s._v("字段是任务的说明。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my_first_job")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" My first job\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my_second_job")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" My second job\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("上面代码的jobs字段包含两项任务，"),n("code",[s._v("job_id")]),s._v("分别是"),n("code",[s._v("my_first_job")]),s._v("和"),n("code",[s._v("my_second_job")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_5-jobs-job-id-needs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-jobs-job-id-needs"}},[s._v("#")]),s._v(" （5）jobs.<job_id>.needs")]),s._v(" "),n("p",[n("code",[s._v("needs")]),s._v("字段指定当前任务的依赖关系，即运行顺序。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" job1\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("needs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("job1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" job2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("上面代码中，"),n("code",[s._v("job1")]),s._v("必须先于"),n("code",[s._v("job2")]),s._v("完成，而"),n("code",[s._v("job3")]),s._v("等待"),n("code",[s._v("job1")]),s._v("和"),n("code",[s._v("job2")]),s._v("的完成才能运行。因此，这个 workflow 的运行顺序依次为："),n("code",[s._v("job1")]),s._v("、"),n("code",[s._v("job2")]),s._v("、"),n("code",[s._v("job3")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_6-jobs-job-id-runs-on"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-jobs-job-id-runs-on"}},[s._v("#")]),s._v(" （6）jobs.<job_id>.runs-on")]),s._v(" "),n("p",[n("code",[s._v("runs-on")]),s._v("字段指定运行所需要的虚拟机环境。它是必填字段。目前可用的虚拟机如下。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ubuntu-latest，ubuntu-18.04或ubuntu-16.04\nwindows-latest，windows-2019或windows-2016\nmacOS-latest或macOS-10.14\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("下面代码指定虚拟机环境为"),n("code",[s._v("ubuntu-18.04")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_7-jobs-job-id-steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-jobs-job-id-steps"}},[s._v("#")]),s._v(" （7）jobs.<job_id>.steps")]),s._v(" "),n("p",[n("code",[s._v("steps")]),s._v("字段指定每个 Job 的运行步骤，可以包含一个或多个步骤。每个步骤都可以指定以下三个字段。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("jobs.<job_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".steps.name：步骤名称。\njobs.<job_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".steps.run：该步骤运行的命令或者 action。\njobs.<job_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(".steps.env：该步骤所需的环境变量。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("下面是一个完整的 workflow 文件的范例。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Greeting from Mona\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" push\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("my-job")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" My Job\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Print a greeting\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MY_VAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Hi there"),n("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),s._v(" My name is\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FIRST_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Mona\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("MIDDLE_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" The\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("LAST_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Octocat\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n        echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("上面代码中，"),n("code",[s._v("steps")]),s._v("字段只包括一个步骤。该步骤先注入四个环境变量，然后执行一条 Bash 命令。")]),s._v(" "),n("h2",{attrs:{id:"四、实例-vuepress-项目发布到-github-pages"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、实例-vuepress-项目发布到-github-pages"}},[s._v("#")]),s._v(" 四、实例：VuePress 项目发布到 GitHub Pages")]),s._v(" "),n("p",[s._v("第一步，这个示例需要将构建成果发到 GitHub 仓库，因此需要 GitHub 密钥。按照"),n("a",{attrs:{href:"https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("，生成一个密钥。然后，将这个密钥储存到当前仓库的"),n("code",[s._v("Settings/Secrets")]),s._v("里面。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(548),alt:"Settings/Secrets"}})]),s._v(" "),n("p",[s._v("上图是储存密钥的环境变量的地方。环境变量的名字可以随便起，这里用的是"),n("code",[s._v("ACCESS_TOKEN")]),s._v("。如果你不用这个名字，后面脚本里的变量名也要跟着改。")]),s._v(" "),n("p",[s._v("第二步，本地计算机使用"),n("code",[s._v("vuepress-theme-reco")]),s._v("，生成一个标准的 vuepress 应用。("),n("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("vuepress-theme-reco官网"),n("OutboundLink")],1),s._v(")")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npx")]),s._v("\nnpx @vuepress-reco/theme-cli init\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npm")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" @vuepress-reco/theme-cli -g\ntheme-cli init\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yarn")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" global "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" @vuepress-reco/theme-cli\ntheme-cli init\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("第三步，在这个仓库的"),n("code",[s._v(".github/workflows")]),s._v("目录，生成一个 workflow 文件，名字可以随便取，这个示例是"),n("code",[s._v("build-and-deploy-github-page.yml")]),s._v("。")]),s._v(" "),n("p",[s._v("我们选用一个别人已经写好的 action："),n("a",{attrs:{href:"https://github.com/marketplace/actions/deploy-to-github-pages",target:"_blank",rel:"noopener noreferrer"}},[s._v("JamesIves/github-pages-deploy-action"),n("OutboundLink")],1),s._v("，它提供了 workflow 的范例文件，直接拷贝过来就行了。")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Build and Deploy Github Page\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branches")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" gh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("source\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build-and-deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runs-on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("latest\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Checkout 🛎️\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" actions/checkout@v2.3.1 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persist-credentials")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Install and Build\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n        npm install\n        npm run build")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deploy 🚀\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" JamesIves/github"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("action@4.1.5\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ACCESS_TOKEN")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.ACCESS_TOKEN "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("BRANCH")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("FOLDER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dest\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("上面这个 workflow 文件的要点如下。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("整个流程在gh-pages-source分支发生push事件时触发。\n只有一个job，运行在虚拟机环境ubuntu-latest。\n第一步是获取源码，使用的 action 是actions/checkout。\n第二步是构建和部署，使用的 action 是JamesIves/github-pages-deploy-action。\n第二步需要四个环境变量，分别为 GitHub 密钥、发布分支、构建成果所在目录、构建脚本。其中，只有 GitHub 密钥是秘密变量，需要写在双括号里面，其他三个都可以直接写在文件里。\n第五步，保存上面的文件后，将整个仓库推送到 GitHub。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("GitHub 发现了 workflow 文件以后，就会自动运行。你可以在网站上实时查看"),n("a",{attrs:{href:"https://github.com/lzpeng723/lzpeng723.github.io/runs/3677817886?check_suite_focus=true",target:"_blank",rel:"noopener noreferrer"}},[s._v("运行日志"),n("OutboundLink")],1),s._v("，日志默认保存30天")]),s._v(" "),n("p",[n("img",{attrs:{src:a(549),alt:"actions"}})]),s._v(" "),n("p",[s._v("等到 workflow 运行结束，访问 "),n("a",{attrs:{href:"https://lzpeng723.github.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub Page"),n("OutboundLink")],1),s._v("，会看到构建成果已经发上网了。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(550),alt:"home"}})]),s._v(" "),n("p",[s._v("以后，每次修改后推送源码，GitHub Actions 都会自动运行，将构建产物发布到网页。")]),s._v(" "),n("h3",{attrs:{id:"五、参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、参考链接"}},[s._v("#")]),s._v(" 五、参考链接")]),s._v(" "),n("p",[n("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("阮一峰 GitHub Actions 入门教程"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://help.github.com/en/categories/automating-your-workflow-with-github-actions",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub Pages 官方文档"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://lukeboyle.com/blog-posts/2019/08/github-actions-for-web-apps/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Github Actions for web apps"),n("OutboundLink")],1),s._v(", Luke Boyle")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://medium.com/@adam.zolyak/my-first-week-with-github-actions-5d92de4c4851",target:"_blank",rel:"noopener noreferrer"}},[s._v("My First Week With GitHub Actions"),n("OutboundLink")],1),s._v(", Adam Zolyak")])])}),[],!1,null,null,null);t.default=e.exports}}]);